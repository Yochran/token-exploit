#pragma once

#ifndef SENDMESSAGE_H
#define SENDMESSAGE_H
#endif

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "../config.h"

/**
 * @brief Execute command
 * 
 * @param argc - argument count
 * @param argv - argument array
 */
void send_message(int argc, char *argv[])
{
    // check argument length
    if (argc < 3)
    {
        printf("%s\n", "Incorrect Usage!\nsend_message <channel_id> <content>");
        return;
    }

    // get channel id
    char *channel_id = argv[1];

    // create content buffer
    char content[2000];
    for (int i = 2; i < argc; i++)
    {
        // concatenate
        char word[256];
        sprintf(word, "%s ", argv[i]);
        strcat(content, word);
    }

    // create json object
    char object[2048];
    sprintf(object, "'{\"content\": \"%s\"}'", content);

    // get command
    char command[4096];
    sprintf(command, "curl -X POST -H \"Authorization: %s\" -H \"Content-Type: application/json\" -H \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36\" -d %s \"https://discordapp.com/api/v9/channels/%s/messages\"", TOKEN, object, channel_id);

    // run commands
    system(command);
    system("clear");

    // print
    printf("Successfully send message to %s.\nContent: %s\n", channel_id, content);
}